{% extends "layout.html" %}
{% block body %}

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <section>
        <form class="form-inline my-2 my-lg-0" method="POST" action="" enctype="multipartform-data">
            <div class="input-group mb-3">
                {{ form.organization_id(class="form-control form-control-lg ",placeholder="Search") }}
                <div class="input-group-append">
                    <button class="btn btn-outline-success " type="submit">Search</button>
                </div>
            </div>

            <div class="row justify-content-end">
                <label for="enroll"> Enter Enroll Key</label>
                <input id="enroll" class="col-4  form-inline " name="enroll" type="input"/>
            </div>
        </form>


    </section>


    {% if result_students %}
        <section class="shadow-lg btn-group-horizontal">
            <form class="form-horizontal" action="" method="POST" enctype="multipart/form-data">
                {{ form.hidden_tag() }}
                {{ result_students }}
                <br/>
                <table id="tblStudents">
                    <tr>
                        <td class='col-md-1'><input id="chk{{ result_students.user_name }}" type="checkbox"
                                                    value="{{ result_students.email }}"/>


                            <label for="chk{{ i.user_name }}">{{ result_students.user_name }}</label></td>


                        <td class='col-4'>{{ result_students.organization_id }}</td>
                        <td class='col-4'>{{ result_students.email }}</td>
                    </tr>
                </table>
                <input class='btn-outline-primary' type="button" value="Add to this Course" onclick="GetSelected()"/>
                <div class="row justify-content-center">
                    <input id="arraySelected" type="hidden" name="selected_students" value=""" hidden/>
                </div>
            </form>
        </section>

    {% endif %}


    {% if students %}
        <form class="form-horizontal" action="" method="POST" enctype="multipart/form-data">
            {{ form.hidden_tag() }}

            <section class="shadow-lg btn-group-horizontal">
                <table id="tblStudents">
                    {% for i in students %}
                        <tr class="row justify-content-start">


                            <td class='col-5'>
                                <input id="chk{{ i.user_name }}" type="checkbox"
                                       aria-label="Checkbox for following text input" value="{{ i.email }}"/>
                                <label for="chk{{ i.user_name }}">{{ i.user_name }}</label>
                            </td>

                            <td class='col-3'>{{ i.organization_id }}</td>
                            <td class='col-4'>{{ i.email }}</td>


                        </tr>
                    {% endfor %}
                </table>

            </section>

            <br/>
            <div class="row justify-content-center">
                <input class=' col-4 btn btn-outline-primary' type="button" value="Add to this Course"
                       onclick="GetSelected()"/>
            </div>
            <!--<input id="arraySelected" type="hidden" name="selected_students" value="" hidden></p>-->
        </form>
    {% endif %}


    <script>
        function GetSelected() {
            //Create an Array.
            var selected = new Array();
            const data = ['🦊', '🐮'];

            //Reference the Table.
            var tblStudents = document.getElementById("tblStudents");

            //Reference all the CheckBoxes in Table.
            var chks = tblStudents.getElementsByTagName("INPUT");

            // Loop and push the checked CheckBox value in Array.
            for (var i = 0; i < chks.length; i++) {
                if (chks[i].checked) {
                    selected.push(chks[i].value);
                    data.splice(
                        data.length,
                        0, chks[i].value);
                }
            }

            //Display the selected CheckBox values.
            if (selected.length > 0) {
                alert("A Joining Key has been sending to the student, by the system ");//+ selected.join(",")
                console.log(data); // ['🦊', '🐮', '🐧', '🐦', '🐤']
                console.log(selected);
            }
            //document.querySelector('arraySelected').value=selected.toString()
            const URL = '/student_list'
            const xhr = new XMLHttpRequest();
            sender = JSON.stringify(selected)
            xhr.open('POST', URL);
            xhr.send(sender)

        };

    </script>

{% endblock body %}
